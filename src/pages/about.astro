---
import BaseLayout from '../layouts/BaseLayout.astro'
---

<BaseLayout title="About Us">
  <span slot="head">
    <style>
      nav a[href="/about"] { background-color: #fec90d; color: #012f63; }
    </style>
  </span>

  <section class="fade-in">
    <h2>About Our School</h2>
    <div class="about-card">
      <p>
        Kamalpur Netaji High School, located in Chhatna, Bankura district of West Bengal, was established on <strong>January 23, 1956</strong>. Founded by <em>Lt. Sudhir Kumar Rakshit</em>, it is a co-educational institution providing education from grades 5 to 12 with a focus on academics, sports, and cultural development.
      </p>
      <div class="anthem-section">
        <h3>Our School Anthem</h3>
        <div class="custom-player">
          <div class="player-header">
            <span class="now-playing">NOW PLAYING</span>
          </div>
          <div class="player-art-wrapper">
            <img src="/assets/images/knhs.webp" alt="KNHS Logo" id="player-art" class="player-art" />
          </div>
          <div class="track-info">
            <div class="track-title">School Anthem</div>
            <div class="track-artist">KNHS</div>
          </div>

          <div class="seekbar-container">
            <input type="range" id="seek-bar" value="0" step="0.1" />
            <div class="time-display">
              <span id="current-time">0:00</span>
              <span id="duration">0:00</span>
            </div>
          </div>

          <div class="main-controls">
            <button id="repeat-btn" class="control-btn" title="Repeat"><i class="fa fa-repeat" id="repeat-icon"></i></button>
            <button id="play-btn" class="play-btn-large"><i class="fa fa-play" id="play-icon"></i></button>
            <button id="mute-btn" class="control-btn" title="Mute"><i class="fa fa-volume-up" id="mute-icon"></i></button>
          </div>

          <div class="volume-container">
            <i class="fa fa-volume-down small-icon"></i>
            <input type="range" id="volume-bar" min="0" max="1" step="0.05" value="0.3" />
            <i class="fa fa-volume-up small-icon"></i>
          </div>

          <audio id="audio-player" preload="metadata">
            <source src="/assets/audio/knhs.opus" type="audio/ogg; codecs=opus" />
            <source src="/assets/audio/knhs.opus" type="audio/opus" />
          </audio>
        </div>
      </div>
    </div>
  </section>

  <script slot="scripts" is:inline type="text/javascript">
    // Audio Player Logic (migrated from original about page)
    const audio = document.getElementById('audio-player');
    const playBtn = document.getElementById('play-btn');
    const playIcon = document.getElementById('play-icon');
    const art = document.getElementById('player-art');
    const seekBar = document.getElementById('seek-bar');
    const currentTimeSpan = document.getElementById('current-time');
    const durationSpan = document.getElementById('duration');
    const volumeBar = document.getElementById('volume-bar');
    const muteBtn = document.getElementById('mute-btn');
    const muteIcon = document.getElementById('mute-icon');
    const repeatBtn = document.getElementById('repeat-btn');
    const repeatIcon = document.getElementById('repeat-icon');

    if (audio) {
      audio.volume = 0.3;

      function updateRangeBackground(range) {
        const min = range.min ? parseFloat(range.min) : 0;
        const max = range.max ? parseFloat(range.max) : 100;
        const val = range.value ? parseFloat(range.value) : 0;
        const percentage = ((val - min) / (max - min)) * 100;
        range.style.background = `linear-gradient(to right, #fec90d ${percentage}%, rgba(255, 255, 255, 0.15) ${percentage}%)`;
        range.style.backgroundSize = '100% 4px';
        range.style.backgroundPosition = 'center';
        range.style.backgroundRepeat = 'no-repeat';
      }

      updateRangeBackground(volumeBar);
      updateRangeBackground(seekBar);

      let isRepeating = false;
      let rotationAngle = 0;
      let isDragging = false;
      let lastPointerAngle = 0;
      let dragHasMoved = false;

      requestAnimationFrame(animateArt);

      function animateArt() {
        if (!audio.paused && !isDragging) { rotationAngle = (rotationAngle + 0.5) % 360; }
        if (art) art.style.transform = `rotate(${rotationAngle}deg)`;
        requestAnimationFrame(animateArt);
      }

      function getPointerAngle(e) {
        const rect = art.getBoundingClientRect();
        const center = { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return Math.atan2(clientY - center.y, clientX - center.x) * (180 / Math.PI);
      }

      function startDrag(e) { if (e.type === 'mousedown' && e.button !== 0) return; e.preventDefault(); isDragging = true; dragHasMoved = false; lastPointerAngle = getPointerAngle(e); }
      function doDrag(e) { if (!isDragging) return; e.preventDefault(); dragHasMoved = true; const currentPointerAngle = getPointerAngle(e); let delta = currentPointerAngle - lastPointerAngle; if (delta > 180) delta -= 360; if (delta < -180) delta += 360; rotationAngle += delta; lastPointerAngle = currentPointerAngle; if (audio.duration) { const seekTimeChange = delta * (15 / 360); audio.currentTime = Math.min(Math.max(audio.currentTime + seekTimeChange, 0), audio.duration); } }
      function endDrag(e) { if (!isDragging) return; isDragging = false; if (!dragHasMoved) { togglePlay(); } }

      art && art.addEventListener('mousedown', startDrag);
      art && art.addEventListener('touchstart', startDrag, { passive: false });
      window.addEventListener('mousemove', doDrag);
      window.addEventListener('touchmove', doDrag, { passive: false });
      window.addEventListener('mouseup', endDrag);
      window.addEventListener('touchend', endDrag);

      playBtn && playBtn.addEventListener('click', togglePlay);

      function togglePlay() { if (audio.paused) { audio.play(); playIcon.classList.remove('fa-play'); playIcon.classList.add('fa-pause'); } else { audio.pause(); playIcon.classList.remove('fa-pause'); playIcon.classList.add('fa-play'); } }

      audio.addEventListener('timeupdate', () => { const value = (audio.currentTime / audio.duration) * 100; seekBar.value = value || 0; currentTimeSpan.textContent = formatTime(audio.currentTime); updateRangeBackground(seekBar); });
      audio.addEventListener('loadedmetadata', () => { durationSpan.textContent = formatTime(audio.duration); });
      if(audio.readyState >= 1) { durationSpan.textContent = formatTime(audio.duration); }

      seekBar.addEventListener('input', () => { const time = (seekBar.value / 100) * audio.duration; audio.currentTime = time; updateRangeBackground(seekBar); });

      volumeBar.addEventListener('input', (e) => { audio.volume = e.target.value; if (audio.volume > 0 && audio.muted) { audio.muted = false; } updateMuteIcon(); updateRangeBackground(volumeBar); });

      muteBtn && muteBtn.addEventListener('click', () => { if (audio.muted) { audio.muted = false; if (audio.volume === 0) { audio.volume = 0.3; } volumeBar.value = audio.volume; } else { audio.muted = true; volumeBar.value = 0; } updateMuteIcon(); updateRangeBackground(volumeBar); });

      function updateMuteIcon() { if (audio.muted || audio.volume === 0) { muteIcon.className = 'fa fa-volume-off'; } else if (audio.volume < 0.5) { muteIcon.className = 'fa fa-volume-down'; } else { muteIcon.className = 'fa fa-volume-up'; } }

      repeatBtn && repeatBtn.addEventListener('click', () => { isRepeating = !isRepeating; if (isRepeating) { repeatIcon.style.color = '#fec90d'; audio.loop = true; repeatBtn.title = "Repeat One: On"; } else { repeatIcon.style.color = 'inherit'; audio.loop = false; repeatBtn.title = "Repeat One: Off"; } });

      audio.addEventListener('ended', () => { if(!isRepeating) { playIcon.classList.remove('fa-pause'); playIcon.classList.add('fa-play'); rotationAngle = 0; art && (art.style.transform = `rotate(0deg)`); seekBar.value = 0; currentTimeSpan.textContent = "0:00"; } });

      function formatTime(seconds) { if(isNaN(seconds)) return "0:00"; const mins = Math.floor(seconds / 60); const secs = Math.floor(seconds % 60); return `${mins}:${secs < 10 ? '0' : ''}${secs}`; }
    }
  </script>
</BaseLayout>

