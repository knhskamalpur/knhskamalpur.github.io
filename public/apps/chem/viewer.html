<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Molecular Viewer - KNHS Chemistry</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../assets/css/styles.css">
    <link rel="stylesheet" href="style.css">
    
    <!-- Kekule.js -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/kekule/dist/themes/default/kekule.css" />
    <script src="https://cdn.jsdelivr.net/npm/kekule/dist/kekule.js?modules=chemWidget,io,algorithm"></script>
    
    <style>
        #viewer-container {
            height: 60vh;
            border: 2px solid #012f63;
            border-radius: 8px;
            background: #fcfcfc;
        }
        .molecule-list {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
            margin-bottom: 20px;
        }
        .mol-item {
            padding: 8px 15px;
            background: #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            color: #333; /* Explicitly dark text */
            border: 1px solid #ccc;
        }
        .mol-item:hover {
            background: #d0d0d0;
        }
        .mol-item.active {
            background: var(--primary-bg);
            color: white; /* White text on dark button is fine */
            border-color: var(--primary-bg);
        }
        .viewer-controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <a href="index.html"><img src="../../assets/images/knhs.webp" alt="KNHS Logo" class="logo"></a>
            <div class="header-text">
                <h1>Molecular Viewer</h1>
                <p class="header-subtitle">Kamalpur Netaji High School (H.S.)</p>
            </div>
        </div>
        <nav>
            <ul>
                <li><a href="index.html"><i class="fa fa-flask"></i> Chem Hub</a></li>
                <li><a href="../../index.html"><i class="fa fa-home"></i> School Home</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="chem-container">
            <h2>3D & 2D Molecule Viewer</h2>
            <p>Select a molecule from the list below to visualize it.</p>
            
            <div class="molecule-list" id="mol-list">
                <div class="mol-item active" onclick="loadMolecule('C', 'Methane (CH4)')">Methane</div>
                <div class="mol-item" onclick="loadMolecule('CC', 'Ethane (C2H6)')">Ethane</div>
                <div class="mol-item" onclick="loadMolecule('C=C', 'Ethene (C2H4)')">Ethene</div>
                <div class="mol-item" onclick="loadMolecule('C#C', 'Ethyne (C2H2)')">Ethyne</div>
                <div class="mol-item" onclick="loadMolecule('c1ccccc1', 'Benzene (C6H6)')">Benzene</div>
                <div class="mol-item" onclick="loadMolecule('CCO', 'Ethanol (C2H5OH)')">Ethanol</div>
                <div class="mol-item" onclick="loadMolecule('CC(=O)O', 'Acetic Acid')">Acetic Acid</div>
                <div class="mol-item" onclick="loadMolecule('CN1C=NC2=C1C(=O)N(C(=O)N2C)C', 'Caffeine')">Caffeine</div>
                <div class="mol-item" onclick="loadMolecule('O', 'Water (H2O)')">Water</div>
            </div>

            <div id="viewer-container" 
                 data-widget="Kekule.ChemWidget.Viewer" 
                 data-predefined-setting="fullFunc"
                 data-render-type="3"
                 data-enable-direct-interaction="true">
            </div>

            <div class="viewer-controls">
                <button class="btn-chem" onclick="toggleDim()">Switch 2D/3D</button>
                <button class="btn-chem" onclick="zoomIn()"><i class="fa fa-search-plus"></i></button>
                <button class="btn-chem" onclick="zoomOut()"><i class="fa fa-search-minus"></i></button>
            </div>

            <div id="mol-info" style="margin-top:20px;">
                <h3 id="mol-name">Methane (CH4)</h3>
                <p id="mol-details">A simple alkane with one carbon and four hydrogen atoms.</p>
            </div>
        </div>
    </main>

    <script>
        let viewer;
        
        Kekule.onReady(() => {
            viewer = Kekule.Widget.getWidgetById('viewer-container');
            loadMolecule('C', 'Methane (CH4)');
        });

        function loadMolecule(smiles, name) {
            try {
                // SMILES format identifier in Kekule consists of 'smi' or 'smiles'
                const mol = Kekule.IO.loadFormatData(smiles, 'smi');
                
                if (mol) {
                    // Molecules from SMILES strings don't have coordinates.
                    // For the 3D viewer to display something, we should ensure coordinates exist.
                    if (viewer.getRenderType() === 3) {
                        if (Kekule.Calculator && Kekule.Calculator.generate3DCoords) {
                            Kekule.Calculator.generate3DCoords(mol, Kekule.CoordMode.COORD3D);
                        }
                    }
                    viewer.setChemObj(mol);
                } else {
                    console.warn('Could not load molecule from SMILES:', smiles);
                }

                document.getElementById('mol-name').textContent = name;
                
                // Highlight active item
                const molList = document.getElementById('mol-list');
                const items = molList.getElementsByClassName('mol-item');
                for (let item of items) {
                    if (item.getAttribute('onclick').includes(smiles)) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                }
            } catch (e) {
                console.error('Error loading molecule:', e);
            }
        }

        function toggleDim() {
            const current = viewer.getRenderType();
            viewer.setRenderType(current === 2 ? 3 : 2);
        }

        function zoomIn() {
            viewer.setZoom(viewer.getZoom() * 1.2);
        }

        function zoomOut() {
            viewer.setZoom(viewer.getZoom() / 1.2);
        }
    </script>
</body>
</html>
